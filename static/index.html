<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="author" content="Gustavo Paulo">
  <title>Tic Tac Toe</title>
  <link rel="stylesheet" href="static/game.css" type="text/css" media="screen" charset="utf-8">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <!-- vue -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.10/lodash.min.js" integrity="sha256-/GKyJ0BQJD8c8UYgf7ziBrs/QgcikS7Fv/SaArgBcEI="
    crossorigin="anonymous"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
</head>

<body>
  <center>
    <h1>Tic Tac Toe</h1>
    <div id="app">
      <table id="board" class="board">
        <tr>
          <td @click="select(0)" id="one" class="even">
            {{ toSymbol(matrix[0]) }}
          </td>
          <td @click="select(1)" id="two">
            {{ toSymbol(matrix[1]) }}
          </td>
          <td @click="select(2)" id="three" class="even">
            {{ toSymbol(matrix[2]) }}
          </td>
        </tr>
        <tr>
          <td @click="select(3)" id="four">
            {{ toSymbol(matrix[3]) }}
          </td>
          <td @click="select(4)" id="five" class="even">
            {{ toSymbol(matrix[4]) }}
          </td>
          <td @click="select(5)" id="six">
            {{ toSymbol(matrix[5]) }}
          </td>
        </tr>
        <tr>
          <td @click="select(6)" id="seven" class="even">
            {{ toSymbol(matrix[6]) }}
          </td>
          <td @click="select(7)" id="eight">
            {{ toSymbol(matrix[7]) }}
          </td>
          <td @click="select(8)" id="nine" class="even">
            {{ toSymbol(matrix[8]) }}
          </td>
        </tr>
      </table>

      <div class="game-messages">
        <h3 v-if="finished">FINISH</h3>
      </div>

      <button @click="reset" id="btn-reset">Reset</button>
    </div>
  </center>
  <script>
    var app = new Vue({
      el: '#app',
      data: () => ({
        // visual data
        matrix: [0, 0, 0, 0, 0, 0, 0, 0, 0],

        // others
        turn: -1,
        ai: true,
        finished: false,
      }),
      computed: {
        token() {
          return btoa(JSON.stringify(this.matrix))
        }
      },
      methods: {
        // reset board
        reset() {
          this.matrix = [0, 0, 0, 0, 0, 0, 0, 0, 0];
          this.turn = -1;
          this.finished = false;
        },

        // convert number to symbol
        toSymbol(n) {
          if (n === -1) return 'X';
          else if (n === 1) return 'O';
          else return '';
        },

        // handle selection
        async select(n) {
          // AI turn
          if (this.turn === 0 || this.finished) return;

          // set cell
          if (this.matrix[n] === 0) {
            this.$set(this.matrix, n, this.turn);

            // if IA enabled
            if (this.ai) {
              this.turn = 0;

              // suggest move with IA
              try {
                const { data } = await axios.get(`/suggest/${this.token}`);
                if (data[0] === null || data[1] === null) {
                  this.finished = true;
                  return
                }

                // set move
                this.$set(this.matrix, (data[0] * 3) + data[1], 1);
                this.turn = -1;
              } catch (err) {
                console.error(err)
              }
            } else {
              this.turn = 1;
            }
          }
        },
      }
    })
  </script>
</body>

</html>
